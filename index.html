<script>
const allChapters = [];
Object.entries(bible).forEach(([book, count]) => {
  for (let i = 1; i <= count; i++) {
    allChapters.push(`${book} ${i}`);
  }
});

let completed = [];
let current = null;

// Update remaining count
function updateRemaining() {
  document.getElementById("remaining").textContent =
    allChapters.length - completed.length;
}

// Pick a random unread chapter
function pickChapter() {
  const remaining = allChapters.filter(c => !completed.includes(c));
  if (remaining.length === 0) {
    document.getElementById("chapter").textContent = "ðŸŽ‰ Bible Completed! ðŸŽ‰";
    return;
  }
  current = remaining[Math.floor(Math.random() * remaining.length)];
  document.getElementById("chapter").textContent = current;
}

// Mark the current chapter as completed
async function markCompleted() {
  if (!current || completed.includes(current)) return;

  completed.push(current);

  // Save to localStorage as backup
  localStorage.setItem("completedChapters", JSON.stringify(completed));

  // Save to Firebase Firestore
  if (window.saveProgress) {
    await window.saveProgress(completed);
  }

  current = null;
  document.getElementById("chapter").textContent = "Marked completed âœ”";
  updateRemaining();
}

// Load progress from Firebase on page load
async function initProgress() {
  if (window.loadProgress) {
    completed = await window.loadProgress();
  }

  // Fallback to localStorage if nothing in Firebase
  if (!completed.length) {
    completed = JSON.parse(localStorage.getItem("completedChapters") || "[]");
  }

  updateRemaining();
}

// Initialize on page load
initProgress();
</script>
